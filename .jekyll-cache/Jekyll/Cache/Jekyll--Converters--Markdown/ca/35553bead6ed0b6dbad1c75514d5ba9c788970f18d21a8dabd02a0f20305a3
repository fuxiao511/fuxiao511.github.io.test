I"K<h2 id="从上向下看">从上向下看</h2>

<ol>
  <li>为什么vcpu不在虚拟机状态运行</li>
  <li>qemu角度看</li>
  <li>内核角度看</li>
  <li>脏页、IO？引起的卡顿</li>
</ol>

<h2 id="虚拟机状态">虚拟机状态</h2>

<p>vcpu看虚拟机都是SLEEPING</p>

<p>看栈信息有两种</p>

<p>sys_futex和kvm_vcpu_block</p>

<h2 id="qemu角度">qemu角度</h2>

<h2 id="内核角度">内核角度</h2>

<p>生成core文件</p>

<p>stack卡在kvm_vcpu_block，可能是执行hlt后在等待中断</p>

<p>中断在lapic.c中会有wake_up_interrupible(q)</p>
:ET